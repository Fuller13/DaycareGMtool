<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daggerheart Digital GM Tool</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Barlow&display=swap" rel="stylesheet"> <!-- For nav fonts -->
  <style>
    :root {
      --dh-color-dark-blue: #0a0f21;
      --dh-color-purple: #1e184d;
      --dh-color-purple-light: #38227b;
      --dh-color-gold: #f3c267;
      --dh-color-gold-light: #fef790;
      --dh-color-gold-dark: #e38c3e;
      --dh-color-teal: #81ccc3;
      --dh-color-blue: #2878be;
      --dh-color-off-white: #F2F3F4;
      --dh-color-gray: #d8d8d6;
      --top-nav-button-color: white;
      --top-nav-button-hover-color: #22b8cf;
      --breadcrumbs-bg: unset;
      --breadcrumbs-font-color: rgb(191, 191, 191);
      --breadcrumbs-separator-color: rgb(191, 191, 191);
      --breadcrumbs-link-hover: rgb(191, 191, 191);
      --breadcrumbs-location-color: rgb(191, 191, 191);
      --breadcrumbs-font: "Eveleth-Clean";
      --breadcrumbs-separator-font: "Eveleth-Clean";
      --breadcrumbs-location-font: "Eveleth-Clean";
      --h1-font: Eveleth-Thin;
      --h2-font: Eveleth-Clean;
      --h3-font: Eveleth-Clean;
      --h4-font: Questa-Sans;
      --p-font: Questa-Light;
      --p-font-em: Questa-Italic;
      --p-font-bold: Questa-Bold;
      --p-font-em-bold: Questa-EmBold;
      --p-tip-font: Questa-EmSlab;
      --dh-color-mustard: #927c3e;
      --dh-color-pale-mustard: #ece7da;
      --dh-color-vibrant-mustard: #dab65d;
      --dh-color-forest: #57653d;
      --dh-color-pale-forest: #868b6f;
      --dh-color-faded: #f0f1eb;
      --dh-color-chocolate: #241e1d;
      --dh-color-clay: #ab5b2c;
      --dh-color-pale-clay: #f6ede5;
      --dh-color-blood: #9b2a29;
      --dh-color-light-teal: #376771;
      --dh-color-purple-book: #6f3e83;
      --dh-color-pale-purple: #f5f2f6;
      --base-font: 18px;
      --font-scale: 1.2;
      --font-size-1: var(--base-font);
      --font-size-2: calc(var(--base-font) * var(--font-scale));
      --font-size-3: calc(var(--font-size-2) * var(--font-scale));
      --font-size-4: calc(var(--font-size-3) * var(--font-scale));
      --font-size-5: calc(var(--font-size-4) * var(--font-scale));
      --top-nav-button-font: 'Barlow';
      --top-nav-button-font-size: 16px;
      --top-nav-bottom-border-size: 0px;
      --top-nav-bottom-border-color: transparent;
      --top-nav-header-background-color-1: black;
      --top-nav-header-background-color-2: black;
      --top-nav-header-member-button-color-1: rgb(0, 171, 255);
      --top-nav-header-member-button-color-2: rgb(13, 73, 255);
      --top-nav-active-menu-button-color: var(--top-nav-button-hover-color);
      --mobile-nav-button-color: white;
      --mobile-nav-inner-bg-color: black;
      --mobile-nav-button-font: 'Barlow';
      --mobile-nav-button-font-size: 16px;
      --mobile-nav-bottom-border-size: 1px;
      --mobile-nav-bottom-border-color: gray;
      --primary: #fff;
      --primary-2: #f1f3f5;
      --secondary: #000;
      --secondary-2: #111;
      --selection: var(--cyan);
      --text-base: #000;
      --text-primary: #000;
      --text-secondary: #fff;
      --hover: rgba(0, 0, 0, .075);
      --hover-1: rgba(0, 0, 0, .15);
      --hover-2: rgba(0, 0, 0, .25);
      --cyan: #22b8cf;
      --green: #37b679;
      --red: #da3c3c;
      --purple: #f81ce5;
      --blue: #0070f3;
      --pink: #ff0080;
      --pink-light: #ff379c;
      --magenta: #eb367f;
      --violet: #7928ca;
      --violet-dark: #4c2889;
      --accent-0: #fff;
      --accent-1: #fafafa;
      --accent-2: #eaeaea;
      --accent-3: #999;
      --accent-4: #888;
      --accent-5: #666;
      --accent-6: #444;
      --accent-7: #333;
      --accent-8: #111;
      --accent-9: #000;
      --font-sans: -apple-system, system-ui, BlinkMacSystemFont, "Helvetica Neue", "Helvetica", sans-serif;
      --sheet-mobile-header-top: 55px;
      --sheet-mobile-content-top: 105px;
      --app-height: 100%;
    }
    html {
      height: 100%;
      box-sizing: border-box;
      touch-action: manipulation;
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background-color: rgb(32, 32, 32);
      font-family: var(--font-sans);
      color: var(--text-primary);
      overscroll-behavior-x: none;
    }
    body {
      box-sizing: border-box;
      font-weight: 500;
      line-height: 1.5;
      height: 100vh;
      height: var(--app-height);
      margin: 0;
      color: rgb(255, 255, 255);
      font-size: 12px;
      letter-spacing: 0.00938em;
      background-color: rgba(32, 32, 32, 0.95);
    }
    .container {
      display: flex;
      gap: 20px;
    }
    .sidebar {
      width: 220px;
      background-color: var(--dh-color-purple-light);
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
      display: flex;
      flex-direction: column;
      gap: 10px;
      position: sticky;
      top: 20px;
    }
    .main-content {
      flex: 1;
      background-color: #2a2a3a;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
      position: relative;
    }
    .core-panel {
      background-color: #3a3a4a;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 15px;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    .core-panel h2 {
      color: var(--dh-color-gold);
      margin: 0 0 10px 0;
      font-size: 18px;
    }
    .toggle-panel {
      display: none;
      position: absolute;
      top: 20px;
      right: 20px;
      width: 350px;
      max-height: 80vh;
      overflow-y: auto;
      background-color: #3a3a4a;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
      z-index: 10;
      border: 1px solid var(--dh-color-purple-light);
    }
    .toggle-panel.active {
      display: block;
    }
    .toggle-button {
      background-color: var(--dh-color-purple-light);
      color: #ffffff;
      border: none;
      padding: 10px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    .toggle-button:hover {
      background-color: var(--dh-color-purple);
    }
    .counter, .dice-roller, .timer, .action-rolls, .adversary-tracker {
      margin-bottom: 10px;
    }
    .counter button, .dice-roller button, .timer button {
      background-color: #0288d1;
      color: #ffffff;
      border: none;
      padding: 6px 12px;
      margin: 0 5px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .counter button:hover, .dice-roller button:hover, .timer button:hover {
      background-color: #039be5;
    }
    .adversary {
      background-color: #4a4a5a;
      padding: 10px;
      margin: 5px 0;
      border-radius: 4px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 5px;
    }
    .adversary input, .adversary textarea {
      background-color: #5a5a6a;
      color: #ffffff;
      border: 1px solid var(--dh-color-purple-light);
      padding: 6px;
      border-radius: 4px;
      font-size: 14px;
    }
    .adversary textarea {
      grid-column: span 3;
    }
    input, textarea {
      background-color: #4a4a5a;
      color: #ffffff;
      border: 1px solid var(--dh-color-purple-light);
      padding: 8px;
      border-radius: 4px;
      width: 100%;
      box-sizing: border-box;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
    }
    table, th, td {
      border: 1px solid var(--dh-color-purple-light);
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #3a3a4a;
      color: var(--dh-color-gold);
    }
    .drawer-container .drawer-header {
      max-height: unset;
      height: 100px;
      padding-left: 16px;
      padding-right: 16px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--dh-color-gold);
      position: sticky;
      top: 0px;
      z-index: 1999;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: linear-gradient(180deg, var(--dh-color-purple-light) 0%, var(--dh-color-blue) 100%);
    }
    ::-webkit-scrollbar {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <h2 style="color: var(--dh-color-gold); font-size: 20px;">Daggerheart GM Tool</h2>
      <button class="toggle-button" onclick="togglePanel('gm-panel')">GM</button>
      <button class="toggle-button" onclick="togglePanel('rolls-panel')">Rolls</button>
      <button class="toggle-button" onclick="togglePanel('character-panel')">Character</button>
      <button class="toggle-button" onclick="togglePanel('downtime-panel')">Downtime</button>
      <button class="toggle-button" onclick="togglePanel('group-panel')">Group</button>
      <button class="toggle-button" onclick="togglePanel('conditions-panel')">Conditions</button>
      <button class="toggle-button" onclick="togglePanel('death-moves-panel')">Death Moves</button>
      <button class="toggle-button" onclick="togglePanel('adversaries-panel')">Adversaries</button>
      <button class="toggle-button" onclick="togglePanel('hope-fear-panel')">Hope/Fear</button>
    </div>
    <div class="main-content">
      <div class="core-panel counter">
        <h2>Hope/Fear Counters</h2>
        <div>
          Hope: <span id="hope-count">0</span>
          <button onclick="incrementCounter('hope')">+</button>
          <button onclick="decrementCounter('hope')">-</button>
        </div>
        <div>
          Fear: <span id="fear-count">0</span>
          <button onclick="incrementCounter('fear')">+</button>
          <button onclick="decrementCounter('fear')">-</button>
        </div>
      </div>
      <div class="core-panel dice-roller">
        <h2>Digital Dice Roller</h2>
        <button onclick="rollDualityDice()">Roll Duality Dice (2d12)</button>
        <button onclick="rollGMDie()">Roll GM Die (d20)</button>
        <button onclick="rollDamageDice()">Roll Damage Dice</button>
        <div id="dice-result"></div>
      </div>
      <div class="core-panel timer">
        <h2>Countdown Timer</h2>
        <input type="number" id="timer-seconds" placeholder="Seconds" min="0" oninput="saveInput(this)">
        <button onclick="startTimer()">Start</button>
        <button onclick="pauseTimer()">Pause</button>
        <button onclick="resetTimer()">Reset</button>
        <div id="timer-display">00:00</div>
      </div>
      <div class="core-panel action-rolls">
        <h2>Action Roll Options</h2>
        <p><strong>Roll with Hope:</strong> Success = Gain 1 Hope, fantastic outcome. Failure = Less severe consequences, gain 1 Hope.</p>
        <p><strong>Roll with Fear:</strong> Success = GM gains 1 Fear, complications arise. Failure = GM gains 1 Fear, ominous consequences.</p>
        <p><strong>Critical Success (Doubles):</strong> Spectacular success, gain 1 Hope, clear 1 Stress.</p>
        <p><strong>Group Action:</strong> Leader rolls Action Roll; others roll Reaction Rolls (+1 per success, -1 per failure).</p>
        <p><strong>Tag Team Roll:</strong> Spend 3 Hope, both PCs roll, choose one result. Hope = +1 Hope each; Fear = +1 Fear per PC.</p>
      </div>
      <div class="core-panel adversary-tracker">
        <h2>Adversary Tracker</h2>
        <div id="adversaries">
          <div class="adversary">
            <input type="text" placeholder="Name" oninput="saveAdversary(this)">
            <input type="number" placeholder="HP" min="0" oninput="saveAdversary(this)">
            <input type="number" placeholder="Evasion" min="0" oninput="saveAdversary(this)">
            <input type="number" placeholder="Armor" min="0" oninput="saveAdversary(this)">
            <input type="number" placeholder="Agility" min="0" oninput="saveAdversary(this)">
            <input type="number" placeholder="Strength" min="0" oninput="saveAdversary(this)">
            <input type="number" placeholder="Finesse" min="0" oninput="saveAdversary(this)">
            <input type="number" placeholder="Instinct" min="0" oninput="saveAdversary(this)">
            <input type="number" placeholder="Presence" min="0" oninput="saveAdversary(this)">
            <input type="number" placeholder="Knowledge" min="0" oninput="saveAdversary(this)">
            <input type="number" placeholder="Minor Threshold" min="0" oninput="saveAdversary(this)">
            <input type="number" placeholder="Major Threshold" min="0" oninput="saveAdversary(this)">
            <input type="number" placeholder="Severe Threshold" min="0" oninput="saveAdversary(this)">
            <textarea placeholder="Abilities/Notes" oninput="saveAdversary(this)"></textarea>
          </div>
        </div>
        <button onclick="addAdversary()">Add Adversary</button>
      </div>
      <div id="gm-panel" class="toggle-panel">
        <h2>GM</h2>
        <h3>GM Moves</h3>
        <p>GM moves shape the story by reacting to player actions or adding tension. Use when players roll with Fear, fail rolls, act with consequences, offer opportunities, or look to GM for what’s next.</p>
        <ul>
          <li><strong>Reveal an Opportunity:</strong> Offer a new path or benefit (e.g., find a hidden door).</li>
          <li><strong>Introduce a Threat:</strong> Add danger (e.g., adversary ambush).</li>
          <li><strong>Complicate the Situation:</strong> Add obstacles (e.g., collapsing bridge).</li>
          <li><strong>Inflict Harm:</strong> Deal damage or Stress (e.g., adversary hits).</li>
          <li><strong>Advance a Countdown:</strong> Tick a timer (e.g., siege engine nears).</li>
          <li><strong>Use Fear:</strong> Spend Fear for twists or boosts (e.g., extra droid attack).</li>
        </ul>
        <h3>GM Principles</h3>
        <ul>
          <li>Begin and end with the fiction.</li>
          <li>Collaborate at all times, especially during conflict.</li>
          <li>Fill the world with life, wonder, and danger.</li>
          <li>Ask questions and incorporate the answers.</li>
          <li>Make every roll important.</li>
          <li>Play to find out what happens.</li>
          <li>Hold on gently.</li>
        </ul>
        <h3>GM Best Practices</h3>
        <ul>
          <li>Cultivate a curious table.</li>
          <li>Gain your players’ trust.</li>
          <li>Keep the story moving forward.</li>
          <li>Cut to the action.</li>
          <li>Help the players use the game.</li>
          <li>Create a meta conversation.</li>
          <li>Tell them what they would know.</li>
          <li>Ground the world in motive.</li>
          <li>Bring the game’s mechanics to life.</li>
          <li>Reframe rather than reject.</li>
          <li>Work in moments and montages.</li>
        </ul>
      </div>
      <div id="rolls-panel" class="toggle-panel">
        <h2>Rolls</h2>
        <h3>Action Rolls</h3>
        <p>Call for an action roll when outcome is uncertain and interesting. Pick trait, set Difficulty, establish stakes, assign advantage/disadvantage, roll Duality Dice, resolve.</p>
        <h3>Reaction Rolls</h3>
        <p>Same as Action Rolls but no Hope/Fear generated; used for dodging or resisting.</p>
        <h3>Attack Rolls</h3>
        <p>Adversary rolls d20 + modifier vs. PC Evasion. On hit, roll damage vs. thresholds. Spend Fear for Experience boost.</p>
      </div>
      <div id="character-panel" class="toggle-panel">
        <h2>Character</h2>
        <p><strong>Evasion:</strong> GM rolls vs. this to hit; avoid attacks/effects.</p>
        <p><strong>HP:</strong> Abstract health; mark based on damage thresholds.</p>
        <p><strong>Thresholds:</strong> Minor (1 HP), Major (2 HP), Severe (3 HP); add level to base from armor.</p>
        <p><strong>Armor Slots:</strong> Spend 1 per attack to reduce threshold by 1; max = Armor Score.</p>
        <p><strong>Stress:</strong> Max 6 slots; mark for abilities/consequences; full = mark HP instead.</p>
      </div>
      <div id="downtime-panel" class="toggle-panel">
        <h2>Downtime</h2>
        <h3>Short Rest</h3>
        <ul>
          <li>Tend to Wounds: Clear 1d4 + Tier HP (or ally).</li>
          <li>Clear Stress: Clear 1d4 + Tier Stress.</li>
          <li>Repair Armor: Clear 1d4 + Tier Armor Slots (or ally).</li>
          <li>Prepare: Gain 1 Hope (2 if with allies).</li>
        </ul>
        <p>GM gains 1d4 Fear. Swap domain cards.</p>
        <h3>Long Rest</h3>
        <ul>
          <li>Tend to All Wounds: Clear all HP (or ally).</li>
          <li>Clear All Stress: Clear all Stress.</li>
          <li>Repair All Armor: Clear all Armor Slots (or ally).</li>
          <li>Prepare: Gain 1 Hope (2 if with allies).</li>
          <li>Work on Project: Advance project countdown.</li>
        </ul>
        <p>GM gains PCs + 1d4 Fear; advance long-term countdown. Swap domain cards.</p>
      </div>
      <div id="group-panel" class="toggle-panel">
        <h2>Group</h2>
        <h3>Group Actions</h3>
        <p>Leader rolls Action Roll; others Reaction Rolls (+1 per success, -1 per failure).</p>
        <h3>Helping Allies</h3>
        <p>Spend Hope, roll d6 advantage to add to ally’s roll (take highest if multiple).</p>
        <h3>Tag Team Roll</h3>
        <p>Spend 3 Hope once per session; both roll, choose one result. Hope = +1 Hope each; Fear = +1 Fear per PC.</p>
      </div>
      <div id="conditions-panel" class="toggle-panel">
        <h2>Conditions</h2>
        <ul>
          <li><strong>Vulnerable:</strong> All rolls against them have advantage.</li>
          <li><strong>Restrained:</strong> Can't move, but can take actions from current position.</li>
          <li><strong>Hidden:</strong> Rolls against them have disadvantage; ends on attack or if spotted.</li>
          <li><strong>Temporary Conditions:</strong> End after scene or by GM/PC action (e.g., Cloaked, Unstoppable).</li>
        </ul>
      </div>
      <div id="death-moves-panel" class="toggle-panel">
        <h2>Death Moves</h2>
        <ul>
          <li><strong>Blaze of Glory:</strong> Critical success on final action, but permanent death.</li>
          <li><strong>Avoid Death:</strong> Lose 1 Hope point permanently, survive.</li>
          <li><strong>Risk It All:</strong> Roll to return without dying; failure = death.</li>
        </ul>
      </div>
      <div id="adversaries-panel" class="toggle-panel">
        <h2>Adversaries</h2>
        <h3>Adversary Types</h3>
        <p>Adversaries use d20 for attacks; no Action Rolls. Features trigger on Fear. Improvise based on narrative.</p>
        <h3>Improvising Adversaries Table</h3>
        <table>
          <tr><th>Type</th><th>Example</th><th>Stats/Features</th></tr>
          <tr><td>Minion</td><td>Goblin Scout</td><td>Low HP (5), basic attack (+3).</td></tr>
          <tr><td>Standard</td><td>Orc Warrior</td><td>Medium HP (10), attack (+5), Fear feature (e.g., rage boost).</td></tr>
          <tr><td>Boss</td><td>Dragon</td><td>High HP (20+), multiple attacks, Fear abilities (e.g., breath weapon).</td></tr>
        </table>
      </div>
      <div id="hope-fear-panel" class="toggle-panel">
        <h2>Hope/Fear</h2>
        <h3>Hope Uses</h3>
        <ul>
          <li>Help Ally (+d6 advantage).</li>
          <li>Utilize Experience (+2).</li>
          <li>Initiate Tag Team Roll (3 Hope).</li>
          <li>Activate Hope Feature.</li>
        </ul>
        <h3>Fear Uses</h3>
        <ul>
          <li>Interrupt PC action.</li>
          <li>Extra GM move.</li>
          <li>Spotlight additional adversary.</li>
          <li>Use adversary/environment Fear feature.</li>
          <li>Add adversary Experience to roll.</li>
        </ul>
      </div>
    </div>
  </div>
  <script>
    // Local Storage for Input Persistence
    function saveInput(element) {
      localStorage.setItem(element.id, element.value);
    }
    function loadInputs() {
      document.querySelectorAll('input, textarea').forEach(el => {
        const saved = localStorage.getItem(el.id);
        if (saved) el.value = saved;
      });
    }

    // Hope/Fear Counters
    let hopeCount = 0, fearCount = 0;
    function incrementCounter(type) {
      if (type === 'hope' && hopeCount < 5) hopeCount++;
      if (type === 'fear' && fearCount < 12) fearCount++;
      updateCounterDisplay(type);
      localStorage.setItem(`${type}Count`, type === 'hope' ? hopeCount : fearCount);
    }
    function decrementCounter(type) {
      if (type === 'hope' && hopeCount > 0) hopeCount--;
      if (type === 'fear' && fearCount > 0) fearCount--;
      updateCounterDisplay(type);
      localStorage.setItem(`${type}Count`, type === 'hope' ? hopeCount : fearCount);
    }
    function updateCounterDisplay(type) {
      document.getElementById(`${type}-count`).textContent = type === 'hope' ? hopeCount : fearCount;
    }
    function loadCounters() {
      hopeCount = parseInt(localStorage.getItem('hopeCount') || 0);
      fearCount = parseInt(localStorage.getItem('fearCount') || 0);
      updateCounterDisplay('hope');
      updateCounterDisplay('fear');
    }

    // Dice Roller
    function rollDualityDice() {
      const hope = Math.floor(Math.random() * 12) + 1;
      const fear = Math.floor(Math.random() * 12) + 1;
      const total = hope + fear;
      const outcome = hope > fear ? 'Hope' : fear > hope ? 'Fear' : 'Critical (Doubles)';
      const result = `Total: ${total} (${hope} Hope, ${fear} Fear) - ${outcome}${hope === fear ? ' - Gain 1 Hope, Clear 1 Stress' : ''}`;
      document.getElementById('dice-result').textContent = result;
    }
    function rollGMDie() {
      const roll = Math.floor(Math.random() * 20) + 1;
      document.getElementById('dice-result').textContent = `GM Die (d20): ${roll}`;
    }
    function rollDamageDice() {
      const dice = prompt('Enter damage dice (e.g., 1d6, 2d8):');
      if (!dice) return;
      const match = dice.match(/(\d+)d(\d+)/);
      if (!match) {
        document.getElementById('dice-result').textContent = 'Invalid format';
        return;
      }
      const count = parseInt(match[1]), sides = parseInt(match[2]);
      let total = 0;
      for (let i = 0; i < count; i++) {
        total += Math.floor(Math.random() * sides) + 1;
      }
      document.getElementById('dice-result').textContent = `Damage Roll (${dice}): ${total}`;
    }

    // Countdown Timer
    let timerInterval, timeLeft = 0;
    function startTimer() {
      const input = document.getElementById('timer-seconds').value;
      if (!input || isNaN(input)) return;
      timeLeft = parseInt(input);
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          document.getElementById('timer-display').textContent = '00:00';
          alert('Countdown Complete!');
          return;
        }
        timeLeft--;
        updateTimerDisplay();
      }, 1000);
      updateTimerDisplay();
    }
    function pauseTimer() {
      clearInterval(timerInterval);
    }
    function resetTimer() {
      clearInterval(timerInterval);
      timeLeft = 0;
      document.getElementById('timer-seconds').value = '';
      document.getElementById('timer-display').textContent = '00:00';
    }
    function updateTimerDisplay() {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      document.getElementById('timer-display').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    // Adversary Tracker
    function addAdversary() {
      const adversaryDiv = document.createElement('div');
      adversaryDiv.className = 'adversary';
      adversaryDiv.innerHTML = `
        <input type="text" placeholder="Name" oninput="saveAdversary(this)">
        <input type="number" placeholder="HP" min="0" oninput="saveAdversary(this)">
        <input type="number" placeholder="Evasion" min="0" oninput="saveAdversary(this)">
        <input type="number" placeholder="Armor" min="0" oninput="saveAdversary(this)">
        <input type="number" placeholder="Agility" min="0" oninput="saveAdversary(this)">
        <input type="number" placeholder="Strength" min="0" oninput="saveAdversary(this)">
        <input type="number" placeholder="Finesse" min="0" oninput="saveAdversary(this)">
        <input type="number" placeholder="Instinct" min="0" oninput="saveAdversary(this)">
        <input type="number" placeholder="Presence" min="0" oninput="saveAdversary(this)">
        <input type="number" placeholder="Knowledge" min="0" oninput="saveAdversary(this)">
        <input type="number" placeholder="Minor Threshold" min="0" oninput="saveAdversary(this)">
        <input type="number" placeholder="Major Threshold" min="0" oninput="saveAdversary(this)">
        <input type="number" placeholder="Severe Threshold" min="0" oninput="saveAdversary(this)">
        <textarea placeholder="Abilities/Notes" oninput="saveAdversary(this)"></textarea>
      `;
      document.getElementById('adversaries').appendChild(adversaryDiv);
    }
    function saveAdversary(element) {
      const adversaryDiv = element.closest('.adversary');
      const inputs = adversaryDiv.querySelectorAll('input, textarea');
      const index = Array.from(adversaryDiv.parentNode.children).indexOf(adversaryDiv);
      const data = {
        name: inputs[0].value,
        hp: inputs[1].value,
        evasion: inputs[2].value,
        armor: inputs[3].value,
        agility: inputs[4].value,
        strength: inputs[5].value,
        finesse: inputs[6].value,
        instinct: inputs[7].value,
        presence: inputs[8].value,
        knowledge: inputs[9].value,
        minor: inputs[10].value,
        major: inputs[11].value,
        severe: inputs[12].value,
        notes: inputs[13].value
      };
      localStorage.setItem(`adversary${index}`, JSON.stringify(data));
    }
    function loadAdversaries() {
      const adversaries = document.getElementById('adversaries');
      let index = 0;
      while (localStorage.getItem(`adversary${index}`)) {
        if (index > 0) addAdversary();
        const data = JSON.parse(localStorage.getItem(`adversary${index}`));
        const adversaryDiv = adversaries.children[index];
        const inputs = adversaryDiv.querySelectorAll('input, textarea');
        inputs[0].value = data.name;
        inputs[1].value = data.hp;
        inputs[2].value = data.evasion;
        inputs[3].value = data.armor;
        inputs[4].value = data.agility;
        inputs[5].value = data.strength;
        inputs[6].value = data.finesse;
        inputs[7].value = data.instinct;
        inputs[8].value = data.presence;
        inputs[9].value = data.knowledge;
        inputs[10].value = data.minor;
        inputs[11].value = data.major;
        inputs[12].value = data.severe;
        inputs[13].value = data.notes;
        index++;
      }
    }

    // Toggle Panels with Outside Click Close
    function togglePanel(panelId) {
      document.querySelectorAll('.toggle-panel').forEach(panel => {
        panel.classList.remove('active');
      });
      const panel = document.getElementById(panelId);
      if (panel) panel.classList.add('active');
    }

    document.addEventListener('click', function(event) {
      const activePanel = document.querySelector('.toggle-panel.active');
      if (activePanel && !activePanel.contains(event.target) && !event.target.classList.contains('toggle-button')) {
        activePanel.classList.remove('active');
      }
    });

    // Initialize
    window.onload = () => {
      loadInputs();
      loadCounters();
      loadAdversaries();
    };
  </script>
</body>
</html>
